$(function(){var a,b,c;a={width:$(document).width(),height:($(document).height()-$("#toolbar").outerHeight(true)-4*$("hr").outerHeight(true))*0.9/4};b=(function(){function d(e){this.width=e.width;this.height=e.height;this.color=e.color||"black";this.paper=new Raphael(e.element,this.width,this.height);this.text=this.paper.text(this.width/2,this.height/2,"")}d.prototype.set=function(h){var e,f={},g;this.text.attr({text:h});g=this.text.getBBox(true);f={height:this.height/g.height,width:this.width/g.width};e=this.text.attr("font-size")*((f.width<f.height)?f.width:f.height);this.text.attr({fill:this.color,"font-size":e})};return d}());ko.bindingHandlers.smartbox=(function(d){var e;return{init:function(f,g){e=new b({element:f,width:g().width||d.width,height:g().height||d.height,color:g().color||d.color})},update:function(f,g){e.set(g().value)}}}(a));c={allnone:ko.observable(true),lessons:ko.observableArray([]),trigger:ko.observable(true),isDisplayed:{pinyin:ko.observable(false),english:ko.observable(false)},click:{next:function(){c.isDisplayed.pinyin(false);c.isDisplayed.english(false);c.trigger(!c.trigger())},pinyin:function(){c.isDisplayed.pinyin(true)},english:function(){c.isDisplayed.english(true)}}};c.selectedPhrases=ko.computed(function(){return this.lessons().filter(function(d){return d().checkbox()===true}).reduce(function(d,e){return d.concat(e().phrases)},[])},c);c.randomPhrase=ko.computed(function(){var d=this.selectedPhrases();c.trigger();return(d.length!==0)?d[Math.floor(Math.random()*d.length)]:null},c);c.outputPhrase=ko.computed(function(){var d=this.randomPhrase(),e;return(d)?{traditional:d.traditional,simplified:d.simplified,pinyin:this.isDisplayed.pinyin()?d.pinyin:"pinyin",english:this.isDisplayed.english()?d.english:"english"}:d},c);c.allnone.subscribe(function(d){this.lessons().forEach(function(e){e().checkbox(d)})},c);ko.applyBindings(c);$.ajax({type:"GET",dataType:"json",contentType:"application/json: charset=utf-8",cache:false,url:"/data/vocab.js"}).done(function(d){var e=[];d.forEach(function(f){var g=new Phrase(f);if(!e[g.lesson]){e[g.lesson]=ko.observable({checkbox:ko.observable(true),phrases:[]})}e[g.lesson]().phrases.push(g)});c.lessons(e)}).fail(function(e,f,d){console.log(f)})});